apiVersion: skaffold/v4beta3
kind: Config
metadata:
  name: etcd
manifests:
  rawYaml:
  - example/00-namespace-garden.yaml
  kustomize:
    paths:
    - example/gardener-local/etcd
deploy:
  kubectl: {}
---
apiVersion: skaffold/v4beta3
kind: Config
metadata:
  name: controlplane
requires:
- configs:
  - etcd
build:
  artifacts:
  - image: eu.gcr.io/gardener-project/gardener/apiserver
    ko:
      dependencies:
        paths:
        - cmd/gardener-apiserver/app
        - cmd/utils
        - pkg/api
        - pkg/api/core/shoot
        - pkg/apis/authentication
        - pkg/apis/authentication/install
        - pkg/apis/authentication/v1alpha1
        - pkg/apis/authentication/validation
        - pkg/apis/core
        - pkg/apis/core/helper
        - pkg/apis/core/install
        - pkg/apis/core/v1alpha1
        - pkg/apis/core/v1beta1
        - pkg/apis/core/v1beta1/constants
        - pkg/apis/core/v1beta1/helper
        - pkg/apis/core/validation
        - pkg/apis/extensions
        - pkg/apis/extensions/v1alpha1
        - pkg/apis/operations
        - pkg/apis/operations/install
        - pkg/apis/operations/v1alpha1
        - pkg/apis/operations/validation
        - pkg/apis/operator
        - pkg/apis/operator/v1alpha1
        - pkg/apis/resources
        - pkg/apis/resources/v1alpha1
        - pkg/apis/seedmanagement
        - pkg/apis/seedmanagement/encoding
        - pkg/apis/seedmanagement/helper
        - pkg/apis/seedmanagement/install
        - pkg/apis/seedmanagement/v1alpha1
        - pkg/apis/seedmanagement/v1alpha1/helper
        - pkg/apis/seedmanagement/validation
        - pkg/apis/settings
        - pkg/apis/settings/install
        - pkg/apis/settings/v1alpha1
        - pkg/apis/settings/validation
        - pkg/apiserver
        - pkg/apiserver/admission/initializer
        - pkg/apiserver/features
        - pkg/apiserver/storage
        - pkg/chartrenderer
        - pkg/client/core/clientset/internalversion
        - pkg/client/core/clientset/internalversion/scheme
        - pkg/client/core/clientset/internalversion/typed/core/internalversion
        - pkg/client/core/clientset/versioned
        - pkg/client/core/clientset/versioned/scheme
        - pkg/client/core/clientset/versioned/typed/core/v1alpha1
        - pkg/client/core/clientset/versioned/typed/core/v1beta1
        - pkg/client/core/informers/externalversions
        - pkg/client/core/informers/externalversions/core
        - pkg/client/core/informers/externalversions/core/v1alpha1
        - pkg/client/core/informers/externalversions/core/v1beta1
        - pkg/client/core/informers/externalversions/internalinterfaces
        - pkg/client/core/informers/internalversion
        - pkg/client/core/informers/internalversion/core
        - pkg/client/core/informers/internalversion/core/internalversion
        - pkg/client/core/informers/internalversion/internalinterfaces
        - pkg/client/core/listers/core/internalversion
        - pkg/client/core/listers/core/v1alpha1
        - pkg/client/core/listers/core/v1beta1
        - pkg/client/kubernetes
        - pkg/client/kubernetes/cache
        - pkg/client/seedmanagement/clientset/versioned
        - pkg/client/seedmanagement/clientset/versioned/scheme
        - pkg/client/seedmanagement/clientset/versioned/typed/seedmanagement/v1alpha1
        - pkg/client/seedmanagement/informers/externalversions
        - pkg/client/seedmanagement/informers/externalversions/internalinterfaces
        - pkg/client/seedmanagement/informers/externalversions/seedmanagement
        - pkg/client/seedmanagement/informers/externalversions/seedmanagement/v1alpha1
        - pkg/client/seedmanagement/listers/seedmanagement/v1alpha1
        - pkg/client/settings/clientset/versioned
        - pkg/client/settings/clientset/versioned/scheme
        - pkg/client/settings/clientset/versioned/typed/settings/v1alpha1
        - pkg/client/settings/informers/externalversions
        - pkg/client/settings/informers/externalversions/internalinterfaces
        - pkg/client/settings/informers/externalversions/settings
        - pkg/client/settings/informers/externalversions/settings/v1alpha1
        - pkg/client/settings/listers/settings/v1alpha1
        - pkg/controllerutils
        - pkg/features
        - pkg/gardenlet/apis/config
        - pkg/gardenlet/apis/config/helper
        - pkg/gardenlet/apis/config/v1alpha1
        - pkg/gardenlet/apis/config/validation
        - pkg/logger
        - pkg/openapi
        - pkg/registry/core/backupbucket
        - pkg/registry/core/backupbucket/storage
        - pkg/registry/core/backupentry
        - pkg/registry/core/backupentry/storage
        - pkg/registry/core/cloudprofile
        - pkg/registry/core/cloudprofile/storage
        - pkg/registry/core/controllerdeployment
        - pkg/registry/core/controllerdeployment/storage
        - pkg/registry/core/controllerinstallation
        - pkg/registry/core/controllerinstallation/storage
        - pkg/registry/core/controllerregistration
        - pkg/registry/core/controllerregistration/storage
        - pkg/registry/core/exposureclass
        - pkg/registry/core/exposureclass/storage
        - pkg/registry/core/project
        - pkg/registry/core/project/storage
        - pkg/registry/core/quota
        - pkg/registry/core/quota/storage
        - pkg/registry/core/rest
        - pkg/registry/core/secretbinding
        - pkg/registry/core/secretbinding/storage
        - pkg/registry/core/seed
        - pkg/registry/core/seed/storage
        - pkg/registry/core/shoot
        - pkg/registry/core/shoot/storage
        - pkg/registry/core/shootstate
        - pkg/registry/core/shootstate/storage
        - pkg/registry/operations/bastion
        - pkg/registry/operations/bastion/storage
        - pkg/registry/operations/rest
        - pkg/registry/seedmanagement/managedseed
        - pkg/registry/seedmanagement/managedseed/storage
        - pkg/registry/seedmanagement/managedseedset
        - pkg/registry/seedmanagement/managedseedset/storage
        - pkg/registry/seedmanagement/rest
        - pkg/registry/settings/clusteropenidconnectpreset
        - pkg/registry/settings/clusteropenidconnectpreset/storage
        - pkg/registry/settings/openidconnectpreset
        - pkg/registry/settings/openidconnectpreset/storage
        - pkg/registry/settings/rest
        - pkg/resourcemanager/controller/garbagecollector/references
        - pkg/utils
        - pkg/utils/context
        - pkg/utils/errors
        - pkg/utils/flow
        - pkg/utils/gardener
        - pkg/utils/kubernetes
        - pkg/utils/retry
        - pkg/utils/secrets
        - pkg/utils/secrets/manager
        - pkg/utils/time
        - pkg/utils/timewindow
        - pkg/utils/validation/admissionplugins
        - pkg/utils/validation/cidr
        - pkg/utils/validation/features
        - pkg/utils/validation/kubernetesversion
        - pkg/utils/version
        - plugin/pkg/bastion/validator
        - plugin/pkg/controllerregistration/resources
        - plugin/pkg/global/customverbauthorizer
        - plugin/pkg/global/deletionconfirmation
        - plugin/pkg/global/extensionlabels
        - plugin/pkg/global/extensionvalidation
        - plugin/pkg/global/resourcereferencemanager
        - plugin/pkg/managedseed/shoot
        - plugin/pkg/managedseed/validator
        - plugin/pkg/project/validator
        - plugin/pkg/seed/validator
        - plugin/pkg/shoot/dns
        - plugin/pkg/shoot/dnsrewriting
        - plugin/pkg/shoot/dnsrewriting/apis/shootdnsrewriting
        - plugin/pkg/shoot/dnsrewriting/apis/shootdnsrewriting/install
        - plugin/pkg/shoot/dnsrewriting/apis/shootdnsrewriting/v1alpha1
        - plugin/pkg/shoot/dnsrewriting/apis/shootdnsrewriting/validation
        - plugin/pkg/shoot/exposureclass
        - plugin/pkg/shoot/managedseed
        - plugin/pkg/shoot/nodelocaldns
        - plugin/pkg/shoot/oidc
        - plugin/pkg/shoot/oidc/clusteropenidconnectpreset
        - plugin/pkg/shoot/oidc/openidconnectpreset
        - plugin/pkg/shoot/quotavalidator
        - plugin/pkg/shoot/tolerationrestriction
        - plugin/pkg/shoot/tolerationrestriction/apis/shoottolerationrestriction
        - plugin/pkg/shoot/tolerationrestriction/apis/shoottolerationrestriction/install
        - plugin/pkg/shoot/tolerationrestriction/apis/shoottolerationrestriction/v1alpha1
        - plugin/pkg/shoot/tolerationrestriction/apis/shoottolerationrestriction/validation
        - plugin/pkg/shoot/validator
        - plugin/pkg/shoot/vpa
        - plugin/pkg/utils
        - vendor
        - VERSION
      ldflags:
      - '{{.LD_FLAGS}}'
      main: ./cmd/gardener-apiserver
  - image: eu.gcr.io/gardener-project/gardener/controller-manager
    ko:
      dependencies:
        paths:
        - cmd/gardener-controller-manager/app
        - cmd/gardener-controller-manager/app/bootstrappers
        - cmd/utils
        - pkg/api/extensions
        - pkg/api/indexer
        - pkg/apis/core
        - pkg/apis/core/install
        - pkg/apis/core/v1alpha1
        - pkg/apis/core/v1beta1
        - pkg/apis/core/v1beta1/constants
        - pkg/apis/core/v1beta1/helper
        - pkg/apis/extensions
        - pkg/apis/extensions/v1alpha1
        - pkg/apis/operations
        - pkg/apis/operations/install
        - pkg/apis/operations/v1alpha1
        - pkg/apis/operator
        - pkg/apis/operator/v1alpha1
        - pkg/apis/resources
        - pkg/apis/resources/v1alpha1
        - pkg/apis/seedmanagement
        - pkg/apis/seedmanagement/encoding
        - pkg/apis/seedmanagement/install
        - pkg/apis/seedmanagement/v1alpha1
        - pkg/apis/seedmanagement/v1alpha1/constants
        - pkg/apis/settings
        - pkg/apis/settings/install
        - pkg/apis/settings/v1alpha1
        - pkg/chartrenderer
        - pkg/client/kubernetes
        - pkg/client/kubernetes/cache
        - pkg/component
        - pkg/component/projectrbac
        - pkg/controllermanager/apis/config
        - pkg/controllermanager/apis/config/v1alpha1
        - pkg/controllermanager/apis/config/validation
        - pkg/controllermanager/controller
        - pkg/controllermanager/controller/bastion
        - pkg/controllermanager/controller/certificatesigningrequest
        - pkg/controllermanager/controller/cloudprofile
        - pkg/controllermanager/controller/controllerdeployment
        - pkg/controllermanager/controller/controllerregistration
        - pkg/controllermanager/controller/controllerregistration/controllerregistrationfinalizer
        - pkg/controllermanager/controller/controllerregistration/seed
        - pkg/controllermanager/controller/controllerregistration/seedfinalizer
        - pkg/controllermanager/controller/event
        - pkg/controllermanager/controller/exposureclass
        - pkg/controllermanager/controller/managedseedset
        - pkg/controllermanager/controller/project
        - pkg/controllermanager/controller/project/activity
        - pkg/controllermanager/controller/project/project
        - pkg/controllermanager/controller/project/stale
        - pkg/controllermanager/controller/quota
        - pkg/controllermanager/controller/secretbinding
        - pkg/controllermanager/controller/seed
        - pkg/controllermanager/controller/seed/backupbucketscheck
        - pkg/controllermanager/controller/seed/extensionscheck
        - pkg/controllermanager/controller/seed/lifecycle
        - pkg/controllermanager/controller/seed/secrets
        - pkg/controllermanager/controller/seed/utils
        - pkg/controllermanager/controller/shoot
        - pkg/controllermanager/controller/shoot/conditions
        - pkg/controllermanager/controller/shoot/hibernation
        - pkg/controllermanager/controller/shoot/maintenance
        - pkg/controllermanager/controller/shoot/quota
        - pkg/controllermanager/controller/shoot/reference
        - pkg/controllermanager/controller/shoot/retry
        - pkg/controllermanager/controller/shoot/statuslabel
        - pkg/controllermanager/features
        - pkg/controllerutils
        - pkg/controllerutils/mapper
        - pkg/controllerutils/predicate
        - pkg/controllerutils/routes
        - pkg/features
        - pkg/gardenlet/apis/config
        - pkg/gardenlet/apis/config/v1alpha1
        - pkg/healthz
        - pkg/logger
        - pkg/resourcemanager/controller/garbagecollector/references
        - pkg/utils
        - pkg/utils/chart
        - pkg/utils/context
        - pkg/utils/errors
        - pkg/utils/flow
        - pkg/utils/gardener
        - pkg/utils/imagevector
        - pkg/utils/kubernetes
        - pkg/utils/kubernetes/health
        - pkg/utils/managedresources
        - pkg/utils/managedresources/builder
        - pkg/utils/retry
        - pkg/utils/secrets
        - pkg/utils/secrets/manager
        - pkg/utils/timewindow
        - pkg/utils/validation/kubernetesversion
        - pkg/utils/version
        - vendor
        - VERSION
      ldflags:
      - '{{.LD_FLAGS}}'
      main: ./cmd/gardener-controller-manager
  - image: eu.gcr.io/gardener-project/gardener/scheduler
    ko:
      dependencies:
        paths:
        - cmd/gardener-scheduler/app
        - cmd/utils
        - pkg/api/extensions
        - pkg/apis/core
        - pkg/apis/core/install
        - pkg/apis/core/v1alpha1
        - pkg/apis/core/v1beta1
        - pkg/apis/core/v1beta1/constants
        - pkg/apis/core/v1beta1/helper
        - pkg/apis/extensions
        - pkg/apis/extensions/v1alpha1
        - pkg/apis/operations
        - pkg/apis/operations/install
        - pkg/apis/operations/v1alpha1
        - pkg/apis/operator
        - pkg/apis/operator/v1alpha1
        - pkg/apis/resources
        - pkg/apis/resources/v1alpha1
        - pkg/apis/seedmanagement
        - pkg/apis/seedmanagement/encoding
        - pkg/apis/seedmanagement/install
        - pkg/apis/seedmanagement/v1alpha1
        - pkg/apis/settings
        - pkg/apis/settings/install
        - pkg/apis/settings/v1alpha1
        - pkg/chartrenderer
        - pkg/client/kubernetes
        - pkg/client/kubernetes/cache
        - pkg/controllerutils
        - pkg/controllerutils/predicate
        - pkg/controllerutils/routes
        - pkg/features
        - pkg/gardenlet/apis/config
        - pkg/gardenlet/apis/config/v1alpha1
        - pkg/healthz
        - pkg/logger
        - pkg/resourcemanager/controller/garbagecollector/references
        - pkg/scheduler/apis/config
        - pkg/scheduler/apis/config/v1alpha1
        - pkg/scheduler/apis/config/validation
        - pkg/scheduler/controller
        - pkg/scheduler/controller/shoot
        - pkg/scheduler/features
        - pkg/utils
        - pkg/utils/context
        - pkg/utils/errors
        - pkg/utils/flow
        - pkg/utils/kubernetes
        - pkg/utils/gardener
        - pkg/utils/retry
        - pkg/utils/secrets
        - pkg/utils/timewindow
        - pkg/utils/validation/cidr
        - pkg/utils/validation/kubernetesversion
        - pkg/utils/version
        - vendor
        - VERSION
      ldflags:
      - '{{.LD_FLAGS}}'
      main: ./cmd/gardener-scheduler
  - image: eu.gcr.io/gardener-project/gardener/admission-controller
    ko:
      dependencies:
        paths:
        - cmd/gardener-admission-controller/app
        - cmd/utils
        - pkg/admissioncontroller/apis/config
        - pkg/admissioncontroller/apis/config/helper
        - pkg/admissioncontroller/apis/config/v1alpha1
        - pkg/admissioncontroller/apis/config/validation
        - pkg/admissioncontroller/metrics
        - pkg/admissioncontroller/seedidentity
        - pkg/admissioncontroller/webhook
        - pkg/admissioncontroller/webhook/admission
        - pkg/admissioncontroller/webhook/admission/auditpolicy
        - pkg/admissioncontroller/webhook/admission/internaldomainsecret
        - pkg/admissioncontroller/webhook/admission/kubeconfigsecret
        - pkg/admissioncontroller/webhook/admission/namespacedeletion
        - pkg/admissioncontroller/webhook/admission/resourcesize
        - pkg/admissioncontroller/webhook/admission/seedrestriction
        - pkg/admissioncontroller/webhook/auth/seed
        - pkg/admissioncontroller/webhook/auth/seed/graph
        - pkg/apis/core
        - pkg/apis/core/helper
        - pkg/apis/core/install
        - pkg/apis/core/v1alpha1
        - pkg/apis/core/v1beta1
        - pkg/apis/core/v1beta1/constants
        - pkg/apis/core/v1beta1/helper
        - pkg/apis/extensions
        - pkg/apis/extensions/v1alpha1
        - pkg/apis/operations
        - pkg/apis/operations/install
        - pkg/apis/operations/v1alpha1
        - pkg/apis/operator
        - pkg/apis/operator/v1alpha1
        - pkg/apis/resources
        - pkg/apis/resources/v1alpha1
        - pkg/apis/seedmanagement
        - pkg/apis/seedmanagement/encoding
        - pkg/apis/seedmanagement/install
        - pkg/apis/seedmanagement/v1alpha1
        - pkg/apis/seedmanagement/v1alpha1/helper
        - pkg/apis/settings
        - pkg/apis/settings/install
        - pkg/apis/settings/v1alpha1
        - pkg/chartrenderer
        - pkg/client/kubernetes
        - pkg/client/kubernetes/cache
        - pkg/controllerutils
        - pkg/controllerutils/routes
        - pkg/gardenlet/apis/config
        - pkg/gardenlet/apis/config/v1alpha1
        - pkg/gardenlet/bootstrap/util
        - pkg/healthz
        - pkg/logger
        - pkg/resourcemanager/controller/garbagecollector/references
        - pkg/utils
        - pkg/utils/context
        - pkg/utils/errors
        - pkg/utils/flow
        - pkg/utils/gardener
        - pkg/utils/kubernetes
        - pkg/utils/kubernetes/bootstraptoken
        - pkg/utils/retry
        - pkg/utils/secrets
        - pkg/utils/timewindow
        - pkg/utils/validation/kubernetesversion
        - pkg/utils/version
        - third_party/apiserver/pkg/apis/audit/v1alpha1
        - third_party/apiserver/pkg/apis/audit/v1beta1
        - vendor
        - VERSION
      ldflags:
      - '{{.LD_FLAGS}}'
      main: ./cmd/gardener-admission-controller
deploy:
  helm:
    hooks:
      before:
      - host:
          command:
          - kubectl
          - apply
          - -f
          - example/gardener-local/controlplane/networkpolicy.yaml
    releases:
    - name: gardener-controlplane
      chartPath: charts/gardener/controlplane
      valuesFiles:
        - example/gardener-local/controlplane/values.yaml
      namespace: garden
      setValueTemplates:
        global.admission.image.repository: '{{.IMAGE_REPO_eu_gcr_io_gardener_project_gardener_admission_controller}}'
        global.admission.image.tag: '{{.IMAGE_TAG_eu_gcr_io_gardener_project_gardener_admission_controller}}@{{.IMAGE_DIGEST_eu_gcr_io_gardener_project_gardener_admission_controller}}'
        global.apiserver.image.repository: '{{.IMAGE_REPO_eu_gcr_io_gardener_project_gardener_apiserver}}'
        global.apiserver.image.tag: '{{.IMAGE_TAG_eu_gcr_io_gardener_project_gardener_apiserver}}@{{.IMAGE_DIGEST_eu_gcr_io_gardener_project_gardener_apiserver}}'
        global.controller.image.repository: '{{.IMAGE_REPO_eu_gcr_io_gardener_project_gardener_controller_manager}}'
        global.controller.image.tag: '{{.IMAGE_TAG_eu_gcr_io_gardener_project_gardener_controller_manager}}@{{.IMAGE_DIGEST_eu_gcr_io_gardener_project_gardener_controller_manager}}'
        global.scheduler.image.repository: '{{.IMAGE_REPO_eu_gcr_io_gardener_project_gardener_scheduler}}'
        global.scheduler.image.tag: '{{.IMAGE_TAG_eu_gcr_io_gardener_project_gardener_scheduler}}@{{.IMAGE_DIGEST_eu_gcr_io_gardener_project_gardener_scheduler}}'
      createNamespace: true
      wait: true
profiles:
- name: extensions
  patches:
  - op: add
    path: /deploy/helm/releases/0/setValues
    value:
      global.apiserver.clusterIdentity: gardener-extensions
      global.scheduler.config.schedulers.shoot.candidateDeterminationStrategy: MinimalDistance
      global.scheduler.config.schedulers.shoot.concurrentSyncs: 5
      global.admission.service.clusterIP: fd00:10:2::1000
      global.apiserver.featureGates.IPv6SingleStack: true
  - op: add
    path: /deploy/helm/releases/0/valuesFiles/-
    value: example/provider-extensions/garden/controlplane/values.yaml
- name: ipv6
  activation:
  - env: IPFAMILY=ipv6
  patches:
  - op: add
    path: /deploy/helm/releases/0/setValues
    value:
      global.admission.service.clusterIP: fd00:10:2::1000
      global.apiserver.featureGates.IPv6SingleStack: true
- name: debug
  activation:
  - command: debug
  patches:
  - op: add
    path: /deploy/helm/releases/0/setValues
    value:
      global.apiserver.replicaCount: 1
      global.apiserver.livenessProbe.enable: false
      global.apiserver.readinessProbe.enable: false
      global.admission.replicaCount: 1
      global.admission.config.server.healthProbes.enable: false
      global.controller.replicaCount: 1
      global.controller.config.leaderElection.leaderElect: false
      global.controller.config.server.healthProbes.enable: false
      global.scheduler.replicaCount: 1
      global.scheduler.config.leaderElection.leaderElect: false
      global.scheduler.config.server.healthProbes.enable: false
---
apiVersion: skaffold/v4beta3
kind: Config
metadata:
  name: provider-local
build:
  artifacts:
  - image: eu.gcr.io/gardener-project/gardener/extensions/provider-local
    ko:
      dependencies:
        paths:
        - charts
        - cmd/gardener-extension-provider-local/app
        - cmd/utils
        - extensions/pkg/apis/config
        - extensions/pkg/controller
        - extensions/pkg/controller/backupbucket
        - extensions/pkg/controller/backupentry
        - extensions/pkg/controller/backupentry/genericactuator
        - extensions/pkg/controller/cmd
        - extensions/pkg/controller/common
        - extensions/pkg/controller/controlplane
        - extensions/pkg/controller/controlplane/genericactuator
        - extensions/pkg/controller/dnsrecord
        - extensions/pkg/controller/extension
        - extensions/pkg/controller/healthcheck
        - extensions/pkg/controller/healthcheck/general
        - extensions/pkg/controller/healthcheck/worker
        - extensions/pkg/controller/heartbeat
        - extensions/pkg/controller/heartbeat/cmd
        - extensions/pkg/controller/infrastructure
        - extensions/pkg/controller/operatingsystemconfig
        - extensions/pkg/controller/operatingsystemconfig/oscommon
        - extensions/pkg/controller/operatingsystemconfig/oscommon/actuator
        - extensions/pkg/controller/operatingsystemconfig/oscommon/generator
        - extensions/pkg/controller/operatingsystemconfig/oscommon/template
        - extensions/pkg/controller/worker
        - extensions/pkg/controller/worker/genericactuator
        - extensions/pkg/controller/worker/helper
        - extensions/pkg/predicate
        - extensions/pkg/util
        - extensions/pkg/util/secret/manager
        - extensions/pkg/webhook
        - extensions/pkg/webhook/certificates
        - extensions/pkg/webhook/cmd
        - extensions/pkg/webhook/context
        - extensions/pkg/webhook/controlplane
        - extensions/pkg/webhook/controlplane/genericmutator
        - extensions/pkg/webhook/shoot
        - pkg/api/core
        - pkg/api/extensions
        - pkg/apis/core
        - pkg/apis/core/install
        - pkg/apis/core/v1alpha1
        - pkg/apis/core/v1beta1
        - pkg/apis/core/v1beta1/constants
        - pkg/apis/core/v1beta1/helper
        - pkg/apis/extensions
        - pkg/apis/extensions/v1alpha1
        - pkg/apis/extensions/v1alpha1/helper
        - pkg/apis/operations
        - pkg/apis/operations/install
        - pkg/apis/operations/v1alpha1
        - pkg/apis/operator
        - pkg/apis/operator/v1alpha1
        - pkg/apis/resources
        - pkg/apis/resources/v1alpha1
        - pkg/apis/seedmanagement
        - pkg/apis/seedmanagement/encoding
        - pkg/apis/seedmanagement/install
        - pkg/apis/seedmanagement/v1alpha1
        - pkg/apis/settings
        - pkg/apis/settings/install
        - pkg/apis/settings/v1alpha1
        - pkg/chartrenderer
        - pkg/client/kubernetes
        - pkg/client/kubernetes/cache
        - pkg/component
        - pkg/component/extensions/operatingsystemconfig/original/components
        - pkg/component/extensions/operatingsystemconfig/original/components/containerd
        - pkg/component/extensions/operatingsystemconfig/original/components/docker
        - pkg/component/extensions/operatingsystemconfig/original/components/kubelet
        - pkg/component/extensions/operatingsystemconfig/original/components/containerd/logrotate
        - pkg/component/extensions/operatingsystemconfig/original/components/docker/logrotate
        - pkg/component/extensions/operatingsystemconfig/utils
        - pkg/component/kubeapiserver/constants
        - pkg/component/kubeproxy
        - pkg/controller/service
        - pkg/controllerutils
        - pkg/controllerutils/mapper
        - pkg/controllerutils/predicate
        - pkg/controllerutils/reconciler
        - pkg/extensions
        - pkg/gardenlet/apis/config
        - pkg/gardenlet/apis/config/v1alpha1
        - pkg/healthz
        - pkg/logger
        - pkg/provider-local/apis/local
        - pkg/provider-local/apis/local/helper
        - pkg/provider-local/apis/local/install
        - pkg/provider-local/apis/local/v1alpha1
        - pkg/provider-local/controller/backupbucket
        - pkg/provider-local/controller/backupentry
        - pkg/provider-local/controller/backupoptions
        - pkg/provider-local/controller/controlplane
        - pkg/provider-local/controller/dnsrecord
        - pkg/provider-local/controller/extension/seed
        - pkg/provider-local/controller/extension/shoot
        - pkg/provider-local/controller/healthcheck
        - pkg/provider-local/controller/infrastructure
        - pkg/provider-local/controller/ingress
        - pkg/provider-local/controller/networkpolicy
        - pkg/provider-local/controller/operatingsystemconfig
        - pkg/provider-local/controller/service
        - pkg/provider-local/controller/worker
        - pkg/provider-local/imagevector
        - pkg/provider-local/local
        - pkg/provider-local/webhook/controlplane
        - pkg/provider-local/webhook/controlplaneexposure
        - pkg/provider-local/webhook/dnsconfig
        - pkg/provider-local/webhook/networkpolicy
        - pkg/provider-local/webhook/node
        - pkg/provider-local/webhook/shoot
        - pkg/resourcemanager/controller/garbagecollector/references
        - pkg/utils
        - pkg/utils/chart
        - pkg/utils/context
        - pkg/utils/errors
        - pkg/utils/flow
        - pkg/utils/gardener
        - pkg/utils/images
        - pkg/utils/imagevector
        - pkg/utils/kubernetes
        - pkg/utils/kubernetes/health
        - pkg/utils/kubernetes/unstructured
        - pkg/utils/managedresources
        - pkg/utils/managedresources/builder
        - pkg/utils/retry
        - pkg/utils/secrets
        - pkg/utils/secrets/manager
        - pkg/utils/timewindow
        - pkg/utils/validation/kubernetesversion
        - pkg/utils/version
        - vendor
        - VERSION
      ldflags:
      - '{{.LD_FLAGS}}'
      main: ./cmd/gardener-extension-provider-local
resourceSelector:
  allow:
  # instruct skaffold to inject the built image reference into the image field in our ControllerDeployment
  - groupKind: ControllerDeployment.core.gardener.cloud
    image: [".*"]
manifests:
  rawYaml:
  - example/gardener-local/gardenlet/secret-bootstrap-token.yaml
  kustomize:
    paths:
    - example/provider-local/garden/skaffold
    - example/provider-local/seed-kind/skaffold
deploy:
  kubectl: {}
profiles:
- name: ipv6
  activation:
  - env: IPFAMILY=ipv6
  manifests:
    kustomize:
      paths:
      - example/provider-local/garden/skaffold-ipv6
      - example/provider-local/seed-kind/skaffold
- name: ha-single-zone
  manifests:
    kustomize:
      paths:
      - example/provider-local/garden/skaffold
      - example/provider-local/seed-kind-ha-single-zone/skaffold
- name: ha-multi-zone
  manifests:
    kustomize:
      paths:
      - example/provider-local/garden/skaffold
      - example/provider-local/seed-kind-ha-multi-zone/skaffold
---
apiVersion: skaffold/v4beta3
kind: Config
metadata:
  name: kind2-env
profiles:
- name: kind2
  manifests:
    rawYaml:
    - example/00-namespace-garden.yaml
    kustomize:
      paths:
      - example/provider-local/seed-kind2/skaffold
  deploy:
    kubectl: {}
---
apiVersion: skaffold/v4beta3
kind: Config
metadata:
  name: extensions-env
profiles:
- name: extensions
  manifests:
    rawYaml:
    - example/gardener-local/gardenlet/secret-bootstrap-token-extensions.yaml
    kustomize:
      paths:
      - example/provider-extensions/garden/project
  deploy:
    kubectl: {}
---
apiVersion: skaffold/v4beta3
kind: Config
metadata:
  name: kind2-ha-single-zone-env
profiles:
- name: kind2-ha-single-zone
  manifests:
    kustomize:
      paths:
      - example/provider-local/seed-kind2-ha-single-zone/skaffold
  deploy:
    kubectl: {}
---
apiVersion: skaffold/v4beta3
kind: Config
metadata:
  name: gardenlet
build:
  artifacts:
  - image: eu.gcr.io/gardener-project/gardener/gardenlet
    ko:
      dependencies:
        paths:
        - charts
        - cmd/gardenlet/app
        - cmd/gardenlet/app/bootstrappers
        - cmd/utils
        - pkg/api/extensions
        - pkg/api/indexer
        - pkg/apis/core
        - pkg/apis/core/helper
        - pkg/apis/core/install
        - pkg/apis/core/v1alpha1
        - pkg/apis/core/v1alpha1/helper
        - pkg/apis/core/v1beta1
        - pkg/apis/core/v1beta1/constants
        - pkg/apis/core/v1beta1/helper
        - pkg/apis/core/validation
        - pkg/apis/extensions
        - pkg/apis/extensions/v1alpha1
        - pkg/apis/extensions/v1alpha1/helper
        - pkg/apis/extensions/validation
        - pkg/apis/operations
        - pkg/apis/operations/install
        - pkg/apis/operations/v1alpha1
        - pkg/apis/operator
        - pkg/apis/operator/v1alpha1
        - pkg/apis/resources
        - pkg/apis/resources/v1alpha1
        - pkg/apis/seedmanagement
        - pkg/apis/seedmanagement/encoding
        - pkg/apis/seedmanagement/install
        - pkg/apis/seedmanagement/v1alpha1
        - pkg/apis/seedmanagement/v1alpha1/helper
        - pkg/apis/settings
        - pkg/apis/settings/install
        - pkg/apis/settings/v1alpha1
        - pkg/chartrenderer
        - pkg/client/kubernetes
        - pkg/client/kubernetes/cache
        - pkg/client/kubernetes/clientmap
        - pkg/client/kubernetes/clientmap/builder
        - pkg/client/kubernetes/clientmap/internal
        - pkg/client/kubernetes/clientmap/keys
        - pkg/controller/networkpolicy
        - pkg/controller/networkpolicy/helper
        - pkg/controller/networkpolicy/hostnameresolver
        - pkg/controllerutils
        - pkg/controllerutils/mapper
        - pkg/controllerutils/predicate
        - pkg/controllerutils/reconciler
        - pkg/controllerutils/routes
        - pkg/extensions
        - pkg/features
        - pkg/gardenlet/apis/config
        - pkg/gardenlet/apis/config/helper
        - pkg/gardenlet/apis/config/v1alpha1
        - pkg/gardenlet/apis/config/validation
        - pkg/gardenlet/bootstrap
        - pkg/gardenlet/bootstrap/certificate
        - pkg/gardenlet/bootstrap/util
        - pkg/gardenlet/controller
        - pkg/gardenlet/controller/backupbucket
        - pkg/gardenlet/controller/backupentry
        - pkg/gardenlet/controller/bastion
        - pkg/gardenlet/controller/controllerinstallation
        - pkg/gardenlet/controller/controllerinstallation/care
        - pkg/gardenlet/controller/controllerinstallation/controllerinstallation
        - pkg/gardenlet/controller/controllerinstallation/required
        - pkg/gardenlet/controller/controllerinstallation/utils
        - pkg/gardenlet/controller/managedseed
        - pkg/gardenlet/controller/networkpolicy
        - pkg/gardenlet/controller/seed
        - pkg/gardenlet/controller/seed/care
        - pkg/gardenlet/controller/seed/lease
        - pkg/gardenlet/controller/seed/seed
        - pkg/gardenlet/controller/shoot
        - pkg/gardenlet/controller/shoot/care
        - pkg/gardenlet/controller/shoot/shoot
        - pkg/gardenlet/controller/shoot/shoot/helper
        - pkg/gardenlet/controller/shootstate
        - pkg/gardenlet/controller/shootstate/secret
        - pkg/gardenlet/controller/shootstate/extensions
        - pkg/gardenlet/features
        - pkg/healthz
        - pkg/logger
        - pkg/operation
        - pkg/operation/botanist
        - pkg/component/apiserverproxy
        - pkg/component/nginxingressshoot
        - pkg/component
        - pkg/component/backupentry
        - pkg/component/clusterautoscaler
        - pkg/component/clusteridentity
        - pkg/component/coredns
        - pkg/component/coredns/constants
        - pkg/component/dependencywatchdog
        - pkg/component/etcd
        - pkg/component/etcd/constants
        - pkg/component/etcdcopybackupstask
        - pkg/component/extensions
        - pkg/component/extensions/backupentry
        - pkg/component/extensions/containerruntime
        - pkg/component/extensions/controlplane
        - pkg/component/extensions/crds
        - pkg/component/extensions/dnsrecord
        - pkg/component/extensions/extension
        - pkg/component/extensions/infrastructure
        - pkg/component/extensions/network
        - pkg/component/extensions/operatingsystemconfig
        - pkg/component/extensions/operatingsystemconfig/downloader
        - pkg/component/extensions/operatingsystemconfig/executor
        - pkg/component/extensions/operatingsystemconfig/original
        - pkg/component/extensions/operatingsystemconfig/original/components
        - pkg/component/extensions/operatingsystemconfig/original/components/containerd
        - pkg/component/extensions/operatingsystemconfig/original/components/docker
        - pkg/component/extensions/operatingsystemconfig/original/components/gardeneruser
        - pkg/component/extensions/operatingsystemconfig/original/components/journald
        - pkg/component/extensions/operatingsystemconfig/original/components/kernelconfig
        - pkg/component/extensions/operatingsystemconfig/original/components/kubelet
        - pkg/component/extensions/operatingsystemconfig/original/components/containerd/logrotate
        - pkg/component/extensions/operatingsystemconfig/original/components/docker/logrotate
        - pkg/component/extensions/operatingsystemconfig/original/components/rootcertificates
        - pkg/component/extensions/operatingsystemconfig/original/components/sshdensurer
        - pkg/component/extensions/operatingsystemconfig/original/components/valitail
        - pkg/component/extensions/operatingsystemconfig/original/components/varlibmount
        - pkg/component/extensions/operatingsystemconfig/utils
        - pkg/component/extensions/worker
        - pkg/component/gardeneraccess
        - pkg/component/hvpa
        - pkg/component/istio
        - pkg/component/kubeapiserver
        - pkg/component/kubeapiserver/constants
        - pkg/component/kubeapiserverexposure
        - pkg/component/kubecontrollermanager
        - pkg/component/kubeproxy
        - pkg/component/kubernetesdashboard
        - pkg/component/kubescheduler
        - pkg/component/kubestatemetrics
        - pkg/component/logging/eventlogger
        - pkg/component/logging/kuberbacproxy
        - pkg/component/logging/fluentoperator
        - pkg/component/logging/fluentoperator/customresources
        - pkg/component/logging/vali
        - pkg/component/metricsserver
        - pkg/component/monitoring
        - pkg/component/namespaces
        - pkg/component/nginxingress
        - pkg/component/nodelocaldns
        - pkg/component/nodelocaldns/constants
        - pkg/component/nodeproblemdetector
        - pkg/component/resourcemanager
        - pkg/component/resourcemanager/constants
        - pkg/component/seedsystem
        - pkg/component/shared
        - pkg/component/shootsystem
        - pkg/component/vpa
        - pkg/component/vpa/constants
        - pkg/component/vpnauthzserver
        - pkg/component/vpnseedserver
        - pkg/component/vpnshoot
        - pkg/operation/botanist/matchers
        - pkg/operation/care
        - pkg/operation/common
        - pkg/operation/garden
        - pkg/operation/seed
        - pkg/operation/shoot
        - pkg/resourcemanager/apis/config
        - pkg/resourcemanager/apis/config/v1alpha1
        - pkg/resourcemanager/controller/garbagecollector/references
        - pkg/resourcemanager/webhook/crddeletionprotection
        - pkg/resourcemanager/webhook/endpointslicehints
        - pkg/resourcemanager/webhook/extensionvalidation
        - pkg/resourcemanager/webhook/highavailabilityconfig
        - pkg/resourcemanager/webhook/podschedulername
        - pkg/resourcemanager/webhook/podtopologyspreadconstraints
        - pkg/resourcemanager/webhook/projectedtokenmount
        - pkg/resourcemanager/webhook/seccompprofile
        - pkg/resourcemanager/webhook/systemcomponentsconfig
        - pkg/resourcemanager/webhook/tokeninvalidator
        - pkg/utils
        - pkg/utils/chart
        - pkg/utils/context
        - pkg/utils/errors
        - pkg/utils/flow
        - pkg/utils/gardener
        - pkg/utils/gardener/secretsrotation
        - pkg/utils/gardener/tokenrequest
        - pkg/utils/images
        - pkg/utils/imagevector
        - pkg/utils/kubernetes
        - pkg/utils/kubernetes/bootstraptoken
        - pkg/utils/kubernetes/client
        - pkg/utils/kubernetes/health
        - pkg/utils/kubernetes/unstructured
        - pkg/utils/managedresources
        - pkg/utils/managedresources/builder
        - pkg/utils/retry
        - pkg/utils/secrets
        - pkg/utils/secrets/manager
        - pkg/utils/time
        - pkg/utils/timewindow
        - pkg/utils/validation/admissionplugins
        - pkg/utils/validation/cidr
        - pkg/utils/validation/features
        - pkg/utils/validation/kubernetesversion
        - pkg/utils/version
        - vendor
        - VERSION
      ldflags:
      - '{{.LD_FLAGS}}'
      main: ./cmd/gardenlet
  - image: eu.gcr.io/gardener-project/gardener/resource-manager
    ko:
      dependencies:
        paths:
        - cmd/gardener-resource-manager/app
        - cmd/gardener-resource-manager/app/bootstrappers
        - cmd/utils
        - pkg/api/extensions
        - pkg/api/indexer
        - pkg/apis/core
        - pkg/apis/core/helper
        - pkg/apis/core/install
        - pkg/apis/core/v1alpha1
        - pkg/apis/core/v1beta1
        - pkg/apis/core/v1beta1/constants
        - pkg/apis/core/v1beta1/helper
        - pkg/apis/core/validation
        - pkg/apis/extensions
        - pkg/apis/extensions/v1alpha1
        - pkg/apis/extensions/v1alpha1/helper
        - pkg/apis/extensions/validation
        - pkg/apis/operations
        - pkg/apis/operations/install
        - pkg/apis/operations/v1alpha1
        - pkg/apis/operator
        - pkg/apis/operator/v1alpha1
        - pkg/apis/resources
        - pkg/apis/resources/v1alpha1
        - pkg/apis/resources/v1alpha1/helper
        - pkg/apis/seedmanagement
        - pkg/apis/seedmanagement/encoding
        - pkg/apis/seedmanagement/install
        - pkg/apis/seedmanagement/v1alpha1
        - pkg/apis/settings
        - pkg/apis/settings/install
        - pkg/apis/settings/v1alpha1
        - pkg/chartrenderer
        - pkg/client/kubernetes
        - pkg/client/kubernetes/cache
        - pkg/controllerutils
        - pkg/controllerutils/mapper
        - pkg/controllerutils/predicate
        - pkg/controllerutils/reconciler
        - pkg/controllerutils/routes
        - pkg/features
        - pkg/gardenlet/apis/config
        - pkg/gardenlet/apis/config/v1alpha1
        - pkg/healthz
        - pkg/logger
        - pkg/resourcemanager/apis/config
        - pkg/resourcemanager/apis/config/v1alpha1
        - pkg/resourcemanager/apis/config/validation
        - pkg/resourcemanager/client
        - pkg/resourcemanager/controller
        - pkg/resourcemanager/controller/csrapprover
        - pkg/resourcemanager/controller/garbagecollector
        - pkg/resourcemanager/controller/garbagecollector/references
        - pkg/resourcemanager/controller/health
        - pkg/resourcemanager/controller/health/health
        - pkg/resourcemanager/controller/health/progressing
        - pkg/resourcemanager/controller/health/utils
        - pkg/resourcemanager/controller/managedresource
        - pkg/resourcemanager/controller/node
        - pkg/resourcemanager/controller/node/helper
        - pkg/resourcemanager/controller/networkpolicy
        - pkg/resourcemanager/controller/secret
        - pkg/resourcemanager/controller/tokeninvalidator
        - pkg/resourcemanager/controller/tokenrequestor
        - pkg/resourcemanager/predicate
        - pkg/resourcemanager/webhook
        - pkg/resourcemanager/webhook/crddeletionprotection
        - pkg/resourcemanager/webhook/endpointslicehints
        - pkg/resourcemanager/webhook/extensionvalidation
        - pkg/resourcemanager/webhook/highavailabilityconfig
        - pkg/resourcemanager/webhook/podschedulername
        - pkg/resourcemanager/webhook/podtopologyspreadconstraints
        - pkg/resourcemanager/webhook/projectedtokenmount
        - pkg/resourcemanager/webhook/seccompprofile
        - pkg/resourcemanager/webhook/systemcomponentsconfig
        - pkg/resourcemanager/webhook/tokeninvalidator
        - pkg/utils
        - pkg/utils/context
        - pkg/utils/errors
        - pkg/utils/flow
        - pkg/utils/gardener
        - pkg/utils/kubernetes
        - pkg/utils/kubernetes/health
        - pkg/utils/retry
        - pkg/utils/secrets
        - pkg/utils/timewindow
        - pkg/utils/validation/admissionplugins
        - pkg/utils/validation/cidr
        - pkg/utils/validation/features
        - pkg/utils/validation/kubernetesversion
        - pkg/utils/version
        - vendor
        - VERSION
      ldflags:
      - '{{.LD_FLAGS}}'
      main: ./cmd/gardener-resource-manager
deploy:
  helm:
    releases:
    - name: gardener-gardenlet
      chartPath: charts/gardener/gardenlet
      valuesFiles:
        - example/gardener-local/gardenlet/values.yaml
      namespace: garden
      setValueTemplates:
        image.repository: '{{.IMAGE_REPO_eu_gcr_io_gardener_project_gardener_gardenlet}}'
        image.tag: '{{.IMAGE_TAG_eu_gcr_io_gardener_project_gardener_gardenlet}}@{{.IMAGE_DIGEST_eu_gcr_io_gardener_project_gardener_gardenlet}}'
        # on a local cluster, skaffold uses a local immutable tag for artifacts,
        # overwrite our image vector to use the image that was just built
        # see https://skaffold.dev/docs/deployers/helm/#image-configuration
        imageVectorOverwrite: |
          images:
          - name: gardenlet
            repository: '{{.IMAGE_REPO_eu_gcr_io_gardener_project_gardener_gardenlet}}'
            tag: '{{.IMAGE_TAG_eu_gcr_io_gardener_project_gardener_gardenlet}}@{{.IMAGE_DIGEST_eu_gcr_io_gardener_project_gardener_gardenlet}}'
          - name: gardener-resource-manager
            repository: '{{.IMAGE_REPO_eu_gcr_io_gardener_project_gardener_resource_manager}}'
            tag: '{{.IMAGE_TAG_eu_gcr_io_gardener_project_gardener_resource_manager}}@{{.IMAGE_DIGEST_eu_gcr_io_gardener_project_gardener_resource_manager}}'
      createNamespace: true
      wait: true
    hooks:
      after:
      - host:
          command:
          - bash
          - -ec
          - hack/usage/wait-for.sh seed local GardenletReady Bootstrapped SeedSystemComponentsHealthy ExtensionsReady BackupBucketsReady
profiles:
- name: kind2
  patches:
  - op: add
    path: /deploy/helm/releases/0/valuesFiles/-
    value: example/gardener-local/gardenlet/values-kind2.yaml
  - op: replace
    path: /deploy/helm/hooks/after/0/host/command
    value:
    - bash
    - -ec
    - KUBECONFIG=$GARDENER_LOCAL_KUBECONFIG hack/usage/wait-for.sh seed local2 GardenletReady Bootstrapped SeedSystemComponentsHealthy ExtensionsReady BackupBucketsReady
- name: extensions
  patches:
  - op: add
    path: /deploy/helm/releases/0/valuesFiles/-
    value: example/gardener-local/gardenlet/values-provider-extensions.yaml
  - op: add
    path: /deploy/helm/releases/0/valuesFiles/-
    value: example/provider-extensions/gardenlet/{{.SEED_VALUES}}
  - op: replace
    path: /deploy/helm/hooks/after/0/host/command
    value:
    - bash
    - -ec
    - KUBECONFIG=$GARDENER_LOCAL_KUBECONFIG hack/usage/wait-for.sh seed "$SEED_NAME" GardenletReady Bootstrapped SeedSystemComponentsHealthy ExtensionsReady
- name: ha-single-zone
  patches:
  - op: add
    path: /deploy/helm/releases/0/valuesFiles/-
    value: example/gardener-local/gardenlet/values-kind-ha-single-zone.yaml
  - op: replace
    path: /deploy/helm/hooks/after/0/host/command
    value:
    - bash
    - -ec
    - hack/usage/wait-for.sh seed local-ha-single-zone GardenletReady Bootstrapped SeedSystemComponentsHealthy ExtensionsReady BackupBucketsReady
- name: kind2-ha-single-zone
  patches:
  - op: add
    path: /deploy/helm/releases/0/valuesFiles/-
    value: example/gardener-local/gardenlet/values-kind2-ha-single-zone.yaml
  - op: replace
    path: /deploy/helm/hooks/after/0/host/command
    value:
    - bash
    - -ec
    - KUBECONFIG=$GARDENER_LOCAL_KUBECONFIG hack/usage/wait-for.sh seed local2-ha-single-zone GardenletReady Bootstrapped SeedSystemComponentsHealthy ExtensionsReady BackupBucketsReady
- name: ha-multi-zone
  patches:
  - op: add
    path: /deploy/helm/releases/0/valuesFiles/-
    value: example/gardener-local/gardenlet/values-kind-ha-multi-zone.yaml
  - op: replace
    path: /deploy/helm/hooks/after/0/host/command
    value:
    - bash
    - -ec
    - TIMEOUT=1200 hack/usage/wait-for.sh seed local-ha-multi-zone GardenletReady Bootstrapped SeedSystemComponentsHealthy ExtensionsReady BackupBucketsReady
- name: ipv6
  activation:
  - env: IPFAMILY=ipv6
  patches:
  - op: add
    path: /deploy/helm/releases/0/valuesFiles/-
    value: example/gardener-local/gardenlet/values-ipv6.yaml
- name: debug
  activation:
  - command: debug
  patches:
  - op: add
    path: /deploy/helm/releases/0/setValues
    value:
      replicaCount: 1
      config.leaderElection.leaderElect: false
      config.server.healthProbes.enable: false
